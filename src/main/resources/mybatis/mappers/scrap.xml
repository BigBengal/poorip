<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="scrap">

	<!-- 새로운 스크랩 입력 -->
	<insert id="insert" parameterType="scrapvo">
		<![CDATA[
			insert into scrap values(null, #{usrSeq}, #{trvSeq}, now())
		]]>
	</insert>
	
	<!-- 새로운 스크랩 입력 (공 클릭시)-->
	<insert id="insertscrap" parameterType="scrapvo">
		<![CDATA[
			insert into scrap values(null, #{usrSeq}, #{trvSeq}, now())
		]]>
	</insert>
	
	

	<!-- 스크랩 삭제 -->
	<delete id="delete" parameterType="scrapvo">
		<![CDATA[
			delete from scrap 
			where trv_seq = #{trvSeq} 
			AND usr_seq = #{usrSeq}
		]]>
	</delete>
	
	<!-- 해당 유저가 클릭한 여행정보 스크랩이 있나 확인 -->
	<select id="selectScrap" resultType="integer" parameterType="scrapvo">
		<![CDATA[
			SELECT IFNULL( (SELECT scp_seq as scpSeq FROM scrap WHERE trv_seq = #{trvSeq} and usr_seq = #{usrSeq} LIMIT 1) ,0)
		]]>
	</select>
	
	<!-- 해당 유저의 스크랩 정보 보여주기 -->
	<select id="showScrap" resultType="reviewvo" parameterType="integer">
		<![CDATA[
			select a.trv_seq as trvSeq, b.crt_date as crtDate, 
				   b.name as name, b.contents as contents, b.hours as hours, 
				   b.location as location, b.picture as picture, b.price as price, 
				   b.cat_seq as catSeq, b.contact as contact, c.cty_name as ctyName, c.cty_seq as ctySeq
			from scrap a, travel_info b, city c
			where usr_seq = #{usrSeq}
			and a.trv_seq = b.trv_seq
			and b.cty_seq = c.cty_seq
		]]>
	</select>
	
	<!-- 유저 스크랩 정보중 도시 정보만 가져오기 -->
	<select id="showCity" resultType="scrapcityvo" parameterType="integer">
		<![CDATA[
		select c.CTY_NAME as ctyName, c.CTY_SEQ as ctySeq
		from scrap a, travel_info b, city c
		where usr_seq = #{usrSeq} and a.trv_seq = b.trv_seq and b.CTY_SEQ = c.cty_seq group by c.cty_name
	]]>
	</select>

</mapper>
