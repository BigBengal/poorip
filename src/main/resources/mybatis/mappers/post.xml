<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="post">

	<insert id="insert" parameterType="postvo">
		<![CDATA[
			INSERT 
			  INTO POST (POST_SEQ,  title, contents,  REVIEW_PUB_YN,  USR_SEQ,  TRV_SEQ)
			values ( #{postSeq}, #{title}, #{contents}, #{reviewPubYn}, #{usrSeq}, #{trvSeq} )
		]]>
	</insert>
	
	<insert id="addPost" parameterType="postvo">
	    <selectKey keyProperty="postSeq" resultType="integer" order="BEFORE">
			<![CDATA[
			select auto_increment
			  from information_schema.tables
			 where table_schema='bengal'
			   and table_name='post'
			]]>
		</selectKey>
		<![CDATA[
			insert into
				post 
				values(#{postSeq },
						#{title }, 
						#{contents }, 
						#{reviewPubYn },
						#{usrSeq }, 
						#{trvSeq },
						now(),
						'N')
		]]>
	</insert>
	
	<select id="getPostList" resultType="postvo">
	    <![CDATA[
			SELECT POST_SEQ as postSeq,
			       TITLE as title,
			       CONTENTS as contents, 
			       REVIEW_PUB_YN as reviewPubYn, 
			       USR_SEQ as usrSeq, 
			       TRV_SEQ as trvSeq
			  FROM POST
		]]>
	</select>
	
	<select id="getUserPostList" resultType="postvo" parameterType="map">
	    <![CDATA[
			select p.post_seq as postSeq,
				   title,
				   contents,
				   p.usr_seq as usrSeq,
				   p.crt_date as crtDate
				from post p, users u
			where p.USR_SEQ = u.USR_SEQ
			  and p.usr_seq = #{usrSeq }
			order by crt_date desc
			limit #{page}, 3
		]]>
	</select>
	
	<select id="getTotalCounts" resultType="integer" parameterType="integer">
	    <![CDATA[
			select count(*)
		  		from post
		  	where usr_seq = #{usrSeq }
		]]>
	</select>

	<select id="selectbyno" resultType="postvo" parameterType="integer">
		<![CDATA[
			SELECT POST_SEQ as postSeq,
			       TITLE as title,
			       CONTENTS as contents, 
			       REVIEW_PUB_YN as reviewPubYn, 
			       USR_SEQ as usrSeq, 
			       TRV_SEQ as trvSeq
			  FROM POST
			 WHERE POST_SEQ = #{postSeq }
		]]>
	</select>

	<!-- <select id="selectbytravelseq" resultType="postvo" parameterType="integer"> 
		<![CDATA[ SELECT POST_SEQ as postSeq, TITLE as title, CONTENTS as contents, 
		REVIEW_PUB_YN as reviewPubYn, USR_SEQ as usrSeq, TRV_SEQ as trvSeq, CRT_DATE 
		as crtDate FROM POST WHERE TRV_SEQ = #{trvSeq } AND REVIEW_PUB_YN = 'Y' ]]> 
		</select> -->

	<select id="selectbytravelseq" resultType="reviewvo" parameterType="integer">
		<![CDATA[
			select a.POST_SEQ as postSeq, 
				   a.title as title, 
				   a.contents as contents, 
				   a.CRT_DATE as crtDate, 
				   a.TRV_SEQ as trvSeq 
					   from post a, travel_info b 
					   where a.TRV_SEQ = b.trv_seq 
					   and a.REVIEW_PUB_YN='Y' and b.trv_seq=#{trvSeq}
				   order by crtDate desc
		]]>
	</select>
	
	<select id="getAddPostList" resultType="reviewvo" parameterType="integer">
		<![CDATA[
			select
				max(p.post_seq) as postSeq
					from post p,
						 post_pic pp
			where usr_seq = #{usrSeq }
		]]>
	</select>

	<delete id="delete" parameterType="postvo">
		<![CDATA[
			DELETE 
			  FROM POST
			 WHERE POST_SEQ = #{postSeq }
		]]>


	</delete>

</mapper>
