<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="poolparty">


	<!-- 풀 파티 추가 -->
	<insert id="insert"  parameterType="poolpartyvo">
	<selectKey keyProperty="poolSeq" resultType="integer" order="BEFORE">
			<![CDATA[
			select auto_increment
			  from information_schema.tables
			 where table_schema='bengal'
			   and table_name='pool_party'
			]]>
		</selectKey>
		
		<![CDATA[
			insert into pool_party
			(POOL_SEQ, POOL_NAME,  POOL_COMMENT,  POOL_PIC,  cty_Seq,  MANAGER_USR_SEQ,  POOL_PUBLIC_YN)
			values
			(#{poolSeq }, #{poolName }, #{poolComment }, #{poolPic }, #{ctySeq }, #{managerUsrSeq }, #{poolPublicYn } )
		]]>
	</insert>
	
	<!-- 풀 파티 조회-->
	<select id="selectbyseq" resultType="poolpartyvo" parameterType="integer">
		<![CDATA[
			SELECT POOL_SEQ as poolSeq,
			       POOL_NAME as poolName,
			       POOL_COMMENT as poolComment,
			       POOL_PIC as poolPic,
			       cty_Seq as ctySeq,
			       MANAGER_USR_SEQ as managerUsrSeq,
			       POOL_PUBLIC_YN as poolPublic_yn,
			       CRT_DATE as crtDate,
			       FROM_DATE as fromDate,
			       TO_DATE as toDate,
			       HIT,
			       USERS.USR_NICK as managerUsrNick,
			       USERS.USR_PROFILE as managerProfile,
			       USERS.USR_GENDER as managerGender
			  FROM POOL_PARTY, USERS
 			 WHERE POOL_PARTY.MANAGER_USR_SEQ = USERS.USR_SEQ
			   AND POOL_SEQ = #{integer }
		]]>
	</select>
	
	<!-- 풀 파티 조회-->
	<select id="selecttop10" resultType="poolpartyvo">
		<![CDATA[
			SELECT POOL_SEQ as poolSeq,
			       POOL_NAME as poolName,
			       POOL_COMMENT as poolComment,
			       POOL_PIC as poolPic,
			       cty_Seq as ctySeq,
			       MANAGER_USR_SEQ as managerUsrSeq,
			       POOL_PUBLIC_YN as poolPublic_yn,
			       CRT_DATE as crtDate,
			       FROM_DATE as fromDate,
			       TO_DATE as toDate,
			       HIT
			  FROM POOL_PARTY
			 WHERE POOL_PUBLIC_YN = 'Y'
			 ORDER BY HIT desc
			 LIMIT 0,10
		]]>
	</select>
	
	
	<!-- 메인화면에서 도시이름/ 날짜로 풀파티 조회 -->
	<select id="selectbycty" resultType="poolpartyvo" parameterType="poolpartyvo">
		<![CDATA[
	 SELECT pool_seq as poolSeq, 
	 	    pool_name as poolName, 
	 	    pool_comment as poolComment, 
	 	    pool_pic as poolPic, 
	 	    MANAGER_USR_SEQ as managerUsrSeq, 
 		    pool_public_yn as poolPublicYn, 
 		    from_date as fromDate, 
 		    to_date as toDate,
	        HIT
 		FROM pool_party, city
 		WHERE 1=1
 		]]>
 		<if test="fromDate != null and fromDate != ''">
 			<![CDATA[
	 		`from_date` BETWEEN str_to_date(#{fromDate}, '%c/%e/%Y') 
	 			AND DATE_sub(str_to_date(#{toDate}, '%c/%e/%Y'), INTERVAL 1 day)
 			]]> 
 		</if>
 		<![CDATA[
 		AND city.cty_name = #{ctyName}
 		AND city.cty_seq = pool_party.cty_seq
 		AND pool_public_yn = 'Y'
		]]>
	</select>
	
	<!-- 풀 파티 변경-->
	<update id="update" parameterType="poolpartyvo">
		<![CDATA[
			UPDATE POOL_PARTY
			   SET POOL_NAME = #{poolName }
			]]>
			<if test="poolComment != null">
			   <![CDATA[
			   	,POOL_COMMENT  = #{poolComment }
			   ]]>
			</if>
			<if test="poolPic != null">
			   <![CDATA[
			   	,POOL_PIC  = #{poolPic }
			   ]]>
			</if>
			<if test="ctySeq != null">
			   <![CDATA[
			   	,cty_Seq  = #{ctySeq }
			   ]]>
			</if>  
			<if test="managerUsrSeq != null">
			   <![CDATA[
			   	,MANAGER_USR_SEQ  = #{managerUsrSeq }
			   ]]>
			</if>    
			 <if test="poolPublic_yn != null">
			   <![CDATA[
			   	,POOL_PUBLIC_YN  = #{poolPublic_yn }
			   ]]>
			</if> 
			<![CDATA[ 
			WHERE POOL_SEQ = #{poolSeq }
		]]>
	</update>
	
	<!-- 풀 파티 삭제 -->
	<delete id="delete" parameterType="poolpartyvo">
		<![CDATA[
			delete 
			  from POOL_PARTY
			 where POOL_SEQ = #{poolSeq }
		]]>
		
	
	</delete>
	
	<update id="updatehit" parameterType="integer">
		<![CDATA[
			UPDATE POOL_PARTY
			   SET HIT = HIT + 1
			 WHERE POOL_SEQ = #{poolSeq }
		]]>
	</update>
	
</mapper>
